<%- contentFor('head')%>
<% include ./../css %>

<%- contentFor('body')%>

<body id="page-top" class="sidebar-toggled">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <% include ./../sidebar %>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <% include ./../top-bar %>

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Groups</h1>
          </div>

          <div class="row">
            <div class="col-md-12">
              <% if(error){ %>
              <div class="alert alert-danger alert-dismissable">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <strong>¡Error!</strong> <%= error %>
              </div>
              <% } %>
            </div>
          </div>

          <div class="row">
            <!-- Area Chart -->
            <div class="col-xl-12 col-lg-12 col-sm-12 col-xs-12">
              <div class="card shadow mb-4">
                <a href="#collapseCardExample" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="true" aria-controls="collapseCardExample">
                  <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-plus-circle"></i> Add Group</h6>
                </a>
                <!-- Card Content - Collapse -->
                <div class="collapse" id="collapseCardExample">
                  <div class="card-body">
                    <form class="form-horizontal" id="form_agregar">
                      <fieldset>
                        <!-- Text input-->
                        <div class="form-group row">
                          <label for="nombre_clase_agregar" class="col-form-label col-sm-2">Group name</label>
                          <div class="col-md-10">
                            <input id="nombre_clase_agregar" name="nombre" type="text" class="form-control input-md" required="">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="codigo_clase_agregar" class="col-form-label col-sm-2">Group code</label>
                          <div class="input-group col-sm-10">
                            <div class="input-group-prepend" style="width: 100%;">
                              <span class="input-group-text">@</span>
                              <input id="codigo_grupo_administracion_agregar" name="codigoGrupo" type="text" class="form-control input-md" required="">
                            </div>
                            <span class="input-help col-sm-12">
                              <small id="passwordHelpBlock" class="form-text text-muted">This code must be at least 3 characters</small>
                            </span>
                          </div>
                        </div>

                        <div class="form-group row">
                          <label for="profesor_agregar" class="col-form-label col-sm-2">Adviser/Administrator</label>
                          <div class="col-md-10">
                            <select id="profesor_agregar" name="moderador" class="form-control selectpicker" multiple data-live-search="true" data-none-selected-tex>
                              <% for(var i = 0; i < moderadores.length; i++) { %>
                              <% if(moderadores[i].get("permisoPtr").get("clave")=="SUPERADMIN"){%>
                              <option data-subtext="Administrator" value="<%= moderadores[i].id %>"><%= moderadores[i].get("nombre") %> <%= moderadores[i].get("apellidoPaterno") %> <%= moderadores[i].get("apellidoMaterno") %></option>
                              <% }if(moderadores[i].get("permisoPtr").get("clave")=="MODERADOR"){ %>
                              <option data-subtext="Adviser" value="<%= moderadores[i].id %>"><%= moderadores[i].get("nombre") %> <%= moderadores[i].get("apellidoPaterno") %> <%= moderadores[i].get("apellidoMaterno") %></option>
                              <% } %>
                              <% } %>
                            </select>
                            <input hidden type="text" name="currentUser" value="<%= currentUser.id %>">
                          </div>
                        </div>

                        <!-- Button -->
                        <div class="form-group">
                          <div class="col-md-12">
                            <button id="singlebutton" name="singlebutton" class="btn btn-primary btn-block">Save</button>
                          </div>
                        </div>

                      </fieldset>
                    </form>
                  </div>
                </div>
              </div>

              <!--<div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">Groups Data</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12">
                      <ul id="tabs" class="nav nav-pills">
                        <li class="nav-item"><a href="" data-target="#todosLosGrupos" data-toggle="tab" class="nav-link small text-uppercase active">All groups</a></li>
                        <li class="nav-item"><a href="" data-target="#misGrupos" data-toggle="tab" class="nav-link small text-uppercase ">My groups</a></li>
                      </ul>
                      <br>
                      <div id="tabsContent" class="tab-content">
                        <div id="todosLosGrupos" class=" table-responsive tab-pane fade active show">
                          <div class="table-responsive">
                            <table class="table table-bordered" id="dataTableTodoLosGrupos" width="100%" cellspacing="0">

                            </table>
                          </div>
                        </div>
                        <div id="misGrupos" class="table-responsive tab-pane fade">
                          <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">

                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>-->
            </div>
            
            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-xs-12">

              <div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">Groups Data</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                      <div class="table-responsive">
                        <table class="table table-bordered" id="dataTableTodoLosGrupos" width="100%" cellspacing="0">

                        </table>
                      </div>
                  </div>

                </div>
              </div>
            </div>

            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-xs-12">

              <div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">My Groups Data</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                      <div class="table-responsive">
                        <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">

                        </table>
                      </div>
                  </div>

                </div>
              </div>
            </div>

          </div>

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit Group</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form class="form-horizontal" id="form_editar">
          <div class="modal-body">
            <input type="hidden" id="objectId_grupo_editar" name="objectId">
            <!-- Text input-->
            <div class="form-group row">
              <label for="nombre_clase_editar" class="col-form-label col-sm-2">Group name</label>
              <div class="col-md-10">
                <input id="nombre_clase_editar" name="nombre" type="text" class="form-control input-md" required="">
              </div>
            </div>
            <div class="form-group row">
              <label for="codigo_clase_editar" class="col-form-label col-sm-2">Group code</label>
              <div class="input-group col-sm-10">
                <div class="input-group-prepend" style="width: 100%;">
                  <span class="input-group-text">@</span>
                  <input id="codigo_clase_editar" name="codigoClase" type="text" class="form-control input-md" required="" disabled>
                </div>
                <span class="input-help col-sm-12">
                  <small id="passwordHelpBlock" class="form-text text-muted">This code must be at least 3 characters</small>
                </span>
              </div>
            </div>

            <div class="form-group row">
              <label for="profesor_editar" class="col-form-label col-sm-2">Adviser</label>
              <div class="col-md-10">
                <select id="profesor_editar" name="moderador" class="form-control selectpicker ocultar-example" multiple data-live-search="true" data-none-selected-tex>
                  <% for(var i = 0; i < moderadores.length; i++) { %>
                    <% if(moderadores[i].get("permisoPtr").get("clave")=="SUPERADMIN"){%>
                      <option data-subtext="Administrator" value="<%= moderadores[i].id %>"><%= moderadores[i].get("nombre") %> <%= moderadores[i].get("apellidoPaterno") %> <%= moderadores[i].get("apellidoMaterno") %></option>
                    <% }if(moderadores[i].get("permisoPtr").get("clave")=="MODERADOR"){ %>
                      <option data-subtext="Adviser" value="<%= moderadores[i].id %>"><%= moderadores[i].get("nombre") %> <%= moderadores[i].get("apellidoPaterno") %> <%= moderadores[i].get("apellidoMaterno") %></option>
                    <% } %>
                  <% } %>
                </select>
                <input hidden id="currentUser" type="text" name="currentUser" value="<%= currentUser.id %>">
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" onclick="salirGrupo()" class="btn btn-primary">Leave group</button>
            <button type="submit" class="btn btn-primary">Update</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!--<#% include ../../Utilities/spinner %>-->

</body>

<%- contentFor('scripts')%>
<% include ./../scripts %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script type="text/javascript">
  var log = console.log
  $(document).ready(function() {

    $('a[data-toggle="tab"]').on( 'shown.bs.tab', function (e) {
        $.fn.dataTable.tables( {visible: true, api: true} ).columns.adjust();
    });
    
    reloadTable()
  });
</script>
<script type="text/javascript">
  function reloadTable() {
    log("Recargando tabla")
    $.ajax({
      type: "GET",
      url: "/administrador/grupos/datos",
      success: function(response) {
        log("response")

        if ($.fn.DataTable.isDataTable("#dataTable")) {
          $("#dataTable").dataTable().fnDestroy();
          $('#dataTable').empty();
        }
        //Tabla de todos los grupos a los que pertenece el administrador
        var thead = ""
        var tfooter = ""

        thead += '<thead>'
        thead += '<tr>'
        thead += '<th>Group name</th>'
        thead += '<th>Group code</th>'
        thead += '<th>Administrator</th>'
        thead += '<th>Status</th>'
        thead += '<th>Created At</th>'
        thead += '<th>Action</th>'
        thead += '</tr>'
        thead += '</thead>'
        tfooter += '<tfoot>'
        tfooter += '<tr>'
        tfooter += '<th>Group name</th>'
        tfooter += '<th>Group code</th>'
        tfooter += '<th>Administrator</th>'
        tfooter += '<th>Status</th>'
        tfooter += '<th>Created At</th>'
        tfooter += '<th>Action</th>'
        tfooter += '</tr>'
        tfooter += '</tfoot>'

        $('#dataTable').append(thead);
        $('#dataTable').append(tfooter);

        $.fn.dataTable.moment('DD-MM-YYYY');
        $('#dataTable').dataTable({
          processing: true,
          lengthMenu: [100, 50, 25, 15,10 ],
          order: [
            [4, "desc"]
          ],
          deferRender: true,
          data: response.data,
          columns: [{
              data: null,
              render: function(data, type, row) {
                return data["grupoPtr"]["nombre"]
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                return data["grupoPtr"]["codigo"]
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                return data["usuarioPtr"] ? data["usuarioPtr"]["nombre"] + " " + data["usuarioPtr"]["apellidoPaterno"] : ""
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                if (data["grupoPtr"]["active"]) return '<span class="badge badge-success">Activo</span>'
                else return '<span class="badge badge-secondary">Inactivo</span>'
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                return moment(data["grupoPtr"]["createdAt"]).format('DD-MM-YYYY')
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                var data_to_add = ""

                data_to_add = "<div class='row ml-3' style='width:250px'>"

                data_to_add += "<div class='col-md-3'>"
                data_to_add += '<button type"button" onclick="DirigirDetalle(\'' + data["grupoPtr"]["objectId"] + '\')" class="btn btn-info btn-circle" data-toggle="tooltip" data-placement="bottom" title="Students"><i class="fas fa-users"></i></button></span>'
                data_to_add += "</div>"

                data_to_add += "<div class='col-md-3'>"
                data_to_add += '<span data-toggle="modal" onclick="editar(\'' + data["grupoPtr"]["objectId"] + '\',\'' + data["usuarioPtr"]["objectId"] + '\',true)" data-target="#editModal" data-id="' + data["grupoPtr"]["objectId"] + '" data-nombre="' + data["grupoPtr"]["nombre"] + '"  data-codigo="' + data["grupoPtr"]["codigo"] + '" data-profesor="' + data["usuarioPtr"]["objectId"] + '"><button type"button" class="btn btn-primary btn-circle"  data-toggle="tooltip" data-placement="bottom" title="Edit"><i class="fas fa-edit"></i></button></span>'
                data_to_add += "</div>"

                if (data["grupoPtr"]["active"]) {
                  data_to_add += "<div class='col-md-3'>"
                  data_to_add += '<button type"button" onclick="ActivacionGrupo(\'' + data["grupoPtr"]["objectId"] + '\',false)" type="button" class="btn btn-warning btn-circle" data-toggle="tooltip" data-placement="bottom" title="Deactivate"><i class="fas fa-archive"></i></button>'
                  data_to_add += "</div>"
                } else {
                  data_to_add += "<div class='col-md-3'>"
                  data_to_add += '<button type"button" onclick="ActivacionGrupo(\'' + data["grupoPtr"]["objectId"] + '\',true)" type="button" class="btn btn-success btn-circle" data-toggle="tooltip" data-placement="bottom" title="Activate"><i class="fas fa-archive"></i></button>'
                  data_to_add += "</div>"
                }

                data_to_add += "<div class='col-md-3'>"
                data_to_add += '<button type"button" onclick="EliminarGrupo(\'' + data["grupoPtr"]["objectId"] + '\',true)" type="button" class="btn btn-danger btn-circle" data-toggle="tooltip" data-placement="bottom" title="Delete"><i class="fas fa-eraser"></i></button>'
                data_to_add += "</div>"

                data_to_add += "</div>"

                return data_to_add
              }
            }
          ]
        });

        //Tabla de todos los grupos a los que no pertenece el administrador
        if ($.fn.DataTable.isDataTable("#dataTableTodoLosGrupos")) {
          $("#dataTableTodoLosGrupos").dataTable().fnDestroy();
          $('#dataTableTodoLosGrupos').empty();
        }
        
        var thead2 = ""
        var tfooter2 = ""

        thead2 += '<thead>'
        thead2 += '<tr>'
        thead2 += '<th>Group name</th>'
        thead2 += '<th>Group code</th>'
        thead2 += '<th>Status</th>'
        thead2 += '<th>Created At</th>'
        thead2 += '<th>Action</th>'
        thead2 += '</tr>'
        thead2 += '</thead>'
        tfooter2 += '<tfoot>'
        tfooter2 += '<tr>'
        tfooter2 += '<th>Group name</th>'
        tfooter2 += '<th>Group code</th>'
        tfooter2 += '<th>Status</th>'
        tfooter2 += '<th>Created At</th>'
        tfooter2 += '<th>Action</th>'
        tfooter2 += '</tr>'
        tfooter2 += '</tfoot>'

        $('#dataTableTodoLosGrupos').append(thead2);
        $('#dataTableTodoLosGrupos').append(tfooter2);
         $.fn.dataTable.moment('DD-MM-YYYY');
        $('#dataTableTodoLosGrupos').dataTable({
          processing: true,
          lengthMenu: [100, 50, 25, 15,10 ],
          order: [
            [3, "desc"]
          ],
          deferRender: true,
          data: response.dataGrupos,
          columns: [{
              data: null,
              render: function(data, type, row) {
                return data["nombre"]
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                return data["codigo"]
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                if (data["active"]) return '<span class="badge badge-success">Activo</span>'
                else return '<span class="badge badge-secondary">Inactivo</span>'
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                return moment(data["createdAt"]).format('DD-MM-YYYY')
              }
            },
            {
              data: null,
              render: function(data, type, row) {
                var currentUser = $("#currentUser").val()
                var data_to_add = ""

                data_to_add = "<div class='row ml-3' style='width:250px'>"

                data_to_add += "<div class='col-md-3'>"
                data_to_add += '<button type"button" onclick="DirigirDetalle(\'' + data["objectId"] + '\')" class="btn btn-info btn-circle" data-toggle="tooltip" data-placement="bottom" title="Students"><i class="fas fa-users"></i></button></span>'
                data_to_add += "</div>"

                data_to_add += "<div class='col-md-3'>"
                data_to_add += '<span data-toggle="modal" onclick="editar(\'' + data["objectId"] + '\',\'' + currentUser + '\',false)" data-target="#editModal" data-id="' + data["objectId"] + '" data-nombre="' + data["nombre"] + '"  data-codigo="' + data["codigo"] + '" data-profesor="' + data["objectId"] + '"><button type"button" class="btn btn-primary btn-circle"  data-toggle="tooltip" data-placement="bottom" title="Edit"><i class="fas fa-edit"></i></button></span>'
                data_to_add += "</div>"

                if (data["active"]) {
                  data_to_add += "<div class='col-md-3'>"
                  data_to_add += '<button type"button" onclick="ActivacionGrupo(\'' + data["objectId"] + '\',false)" type="button" class="btn btn-warning btn-circle" data-toggle="tooltip" data-placement="bottom" title="Deactivate"><i class="fas fa-archive"></i></button>'
                  data_to_add += "</div>"
                } else {
                  data_to_add += "<div class='col-md-3'>"
                  data_to_add += '<button type"button" onclick="ActivacionGrupo(\'' + data["objectId"] + '\',true)" type="button" class="btn btn-success btn-circle" data-toggle="tooltip" data-placement="bottom" title="Activate"><i class="fas fa-archive"></i></button>'
                  data_to_add += "</div>"
                }


                data_to_add += "<div class='col-md-3'>"
                data_to_add += '<button type"button" onclick="EliminarGrupo(\'' + data["objectId"] + '\',false)" type="button" class="btn btn-danger btn-circle" data-toggle="tooltip" data-placement="bottom" title="Delete"><i class="fas fa-eraser"></i></button>'
                data_to_add += "</div>"

                data_to_add += "</div>"

                return data_to_add
              }
            }
          ]
        });

      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        log(textStatus)
      }
    });
  }
</script>
<script type="text/javascript">
  $("#form_agregar").submit(function(event) {
    event.preventDefault();
    $('#spinner').modal('show')

    $.ajax({
      type: "POST",
      data: $(this).serialize(),
      url: "/administrador/grupos/datos_agregar",
      success: function(response) {
        $('#spinner').modal('hide')
        $('#collapseCardExample').collapse('hide');
        $('.selectpicker').val('');
        $('.selectpicker').selectpicker('render');

        reloadTable()
        $("#form_agregar").trigger("reset");
        Swal.fire(
          'Added!',
          'The group has been added successfully',
          'success'
        )
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        $('#spinner').modal('hide')
        Swal.fire(
          '¡Error!',
          XMLHttpRequest.responseJSON.error + '. Try again',
          'error'
        )
      }
    });
  });
</script>
<script type="text/javascript">
  function ActivacionGrupo(objectId, seActiva) {
    if (seActiva) {
      Swal.fire({
        title: 'Activate',
        text: "Do you want to activate this group?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        cancelButtonText: 'Cancel',
        confirmButtonText: 'Activate'
      }).then((result) => {
        if (result.value) {
          $('#spinner').modal('show')
          $.ajax({
            type: "POST",
            data: {
              "objectId": objectId,
              "seActiva": seActiva
            },
            url: "/administrador/grupos/datos_archivar",
            success: function(response) {
              $('#spinner').modal('hide')
              reloadTable()
              Swal.fire(
                'Activated!',
                'The group has been activated successfully',
                'success'
              )
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              $('#spinner').modal('hide')
              Swal.fire(
                '¡Error!',
                'An error occurred while performing the action, please try again',
                'success'
              )
            }
          })
        }
      })
    } else {
      Swal.fire({
        title: 'Deactivate',
        text: "Do you want to deactivate this group?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        cancelButtonText: 'Cancel',
        confirmButtonText: 'Deactivate'
      }).then((result) => {
        if (result.value) {
          $('#spinner').modal('show')
          $.ajax({
            type: "POST",
            data: {
              "objectId": objectId,
              "seActiva": seActiva
            },
            url: "/administrador/grupos/datos_archivar",
            success: function(response) {
              $('#spinner').modal('hide')
              reloadTable()
              Swal.fire(
                'Deactivated!',
                'The group has been successfully deactivated',
                'success'
              )
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              $('#spinner').modal('hide')
              Swal.fire(
                '¡Error!',
                'An error occurred while performing the action, please try again',
                'success'
              )
            }
          })
        }
      })
    }
  }
</script>
<script type="text/javascript">
  function EliminarGrupo(idGrupo, perteneceAdmin) {
    Swal.fire({
      title: 'Delete',
      text: "Do you want to delete this group?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      cancelButtonText: 'Cancel',
      confirmButtonText: 'Delete'
    }).then((result) => {
      if (result.value) {
        $('#spinner').modal('show')
        $.ajax({
          type: "POST",
          data: {
            "idGrupo": idGrupo,
            "perteneceAdmin": perteneceAdmin
          },
          url: "/administrador/grupos/datos_eliminar",
          success: function(response) {
            $('#spinner').modal('hide')
            reloadTable()
            Swal.fire(
              'Deleted!',
              'The group has been successfully deleted',
              'success'
            )
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
            $('#spinner').modal('hide')
            Swal.fire(
              '¡Error!',
              'An error occurred while performing the action, please try again',
              'error'
            )
          }
        })
      }
    })
  }
</script>
<script type="text/javascript">
  $('#editModal').on('show.bs.modal', function(e) {
    var objectId = $(e.relatedTarget).data('id');
    var nombre = $(e.relatedTarget).data('nombre');
    var codigo = $(e.relatedTarget).data('codigo');
    $("#objectId_grupo_editar").val(objectId);
    $("#nombre_clase_editar").val(nombre);
    $("#codigo_clase_editar").val(codigo);
    $('#profesor_editar').selectpicker('val', '');
  });

  $("#form_editar").submit(function(event) {
    $('#spinner').modal('show')
    event.preventDefault();
    $.ajax({
      type: "POST",
      data: $(this).serialize(),
      url: "/administrador/grupos/datos_editar",
      success: function(response) {
        reloadTable()
        Swal.fire(
          'Edited!',
          'The group has been edited successfully',
          'success'
        )
        $('#spinner').modal('hide')
        $('#editModal').modal('toggle');
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        $('#spinner').modal('hide')
        $('#editModal').modal('toggle');
        Swal.fire(
          '¡Error!',
          'An error occurred while performing the action, please try again',
          'error'
        )
      }
    })
  });

  function editar(idGrupo, idUsuario,admiEngrupo) {
    var currentUser = $("#currentUser").val()
    if(admiEngrupo==true){
      $('.ocultar-example').find('[value="' + currentUser + '"]').hide()
      $('.ocultar-example').selectpicker('refresh');
    }else{
      $('.ocultar-example').find('[value="' + currentUser + '"]').show()
      $('.ocultar-example').selectpicker('refresh');
    }
    
    
    $.ajax({
      type: "POST",
      url: "/administrador/grupos/datos_grupo",
      data: {
        "idGrupo": idGrupo,
        "idUsuario": idUsuario
      },
      success: function(response) {
        $('#profesor_editar').selectpicker('val', response.data);
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        log('An error occurred while performing the action, please try again')
      }
    });
  }
</script>
<script type="text/javascript">
  function salirGrupo() {
    var idGrupo = $("#objectId_grupo_editar").val();

    Swal.fire({
      title: 'Leave group',
      text: 'Do you want to Leave this group?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      cancelButtonText: 'Cancel',
      confirmButtonText: 'Leave'
    }).then((result) => {
      if (result.value) {
        $('#spinner').modal('show')
        $.ajax({
          type: "POST",
          url: "/administrador/grupos/salir_grupo",
          data: {
            "idGrupo": idGrupo
          },
          success: function(response) {
            $('#spinner').modal('hide')
            $('#editModal').modal('toggle');
            reloadTable()
            Swal.fire(
              'Abandoned!',
              'The group has been successfully left',
              'success'
            )
          },
          error: function(XMLHttpRequest, TextStatus, errorThrown) {
            $('#spinner').modal('hide')
            $('#editModal').modal('toggle');
            Swal.fire(
              'Error!',
              'An error occurred while performing the action, please try again',
              'error'
            )
          }
        })
      }
    })
  }
</script>
<script type="text/javascript">
  function DirigirDetalle(objectId) {
    window.location.href = "/administrador/grupos/" + objectId
  }
</script>