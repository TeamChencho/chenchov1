<%- contentFor('head')%>
<% include ./../css %>
<link href="/assets/utils/dropzone/min/dropzone.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
<style type="text/css">
  .dropzone {
    background: white;
    border-radius: 5px;
    border: 2px dashed rgb(0, 135, 247);
    border-image: none;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }
</style>


<%- contentFor('body')%>
<body id="page-top" class="sidebar-toggled">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <% include ./../sidebar %>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <% include ./../top-bar %>        

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">User History - <%= user.get("nombre") %> <%= user.get("apellidoPaterno") %> <%= user.get("apellidoMaterno") %></h1>
            <!--<a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>-->
          </div>
          <input type="hidden" id="userModerador" name="" value='<%= user.id %>'>
          <div class="row">
            <div class="col-md-12">
              <% if(error){ %>
              <div class="alert alert-danger alert-dismissable">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <strong>¡Error!</strong> <%= error %>
              </div>
              <% } %>
            </div>
          </div>

          <div class="row">
            <!-- Area Chart -->
            <div class="col-xl-12 col-lg-12 col-sm-12 col-xs-12">

              <div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">User History Data</h6>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                      
                    </table>
                  </div>
                </div>
              </div>
            </div>

          </div>

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

</body>

<%- contentFor('scripts')%>
<% include ./../scripts %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
<script>
  /**
 * Vista que maneja la interfaz de usuario del historial de Usuarios Moderadores en el sistema de Administración
 * @namespace VistaHistorialUsuariosModeradores
 */

var log = console.log
var table 

  $(document).ready(function() { 
    $("body").tooltip({ selector: '[data-toggle=tooltip]' }); 
    reloadTable()
  });
</script>
<script type="text/javascript">
  /**
   * Función que permite cargar en una tabla todel historial del usuario del sistema
   *
   * @memberof VistaHistorialUsuariosModeradores
   */
  function reloadTable(){
    log("Recargando tabla")
    $.ajax({
      type: "GET",  
      url: "/administrador/advisers/datos_historial",
      data:{
          "user":$("#userModerador").val()
      },
      success: function(response){  
        //log(response.data)
        if ($.fn.DataTable.isDataTable("#dataTable")) {
          //$("#table_report").DataTable().clear().draw();
          $("#dataTable").dataTable().fnDestroy();
          //$("#table_report").dataTable();
          $('#dataTable').empty();
        }

        var thead = ""
        var tfooter = ""

        thead += '<thead>'
          thead += '<tr>'
            thead += '<th>Resource</th>'
            thead += '<th>Activity</th>'
            thead += '<th>Created At</th>'
          thead += '</tr>'
        thead += '</thead>'
        tfooter += '<tfoot>'
          tfooter += '<tr>'
            tfooter += '<th>Resource</th>'
            tfooter += '<th>Activity</th>'
            tfooter += '<th>Created At</th>'
          tfooter += '</tr>'
        tfooter += '</tfoot>'

        $('#dataTable').append(thead);
        $('#dataTable').append(tfooter);

        $.fn.dataTable.moment( 'DD-MM-YYYY' );
        $('#dataTable').dataTable({
          processing: true,
          lengthMenu: [ 100, 10, 25, 50, 75 ],
          order: [[ 2, "desc" ]],
          deferRender: true,
          data: response.data,
          columns: [
            { data: "recurso"},
            { data: "actividad"},
            {
              data: null,
              render: function ( data, type, row ) {
                return moment(data["createdAt"]).format('DD-MM-YYYY HH:mm:ss')
              }
            }
          ]
        });
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) { 
        
      }       
    });
  }
</script>