index.ejs

<%- contentFor('head')%>
<% include ./../css %>

<%- contentFor('body')%>

<body id="page-top" class="sidebar-toggled">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <% include ./../sidebar %>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <% include ./../top-bar %>

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Requests</h1>
            <!--<a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>-->
          </div>

          <div class="row">
            <div class="col-md-12">
              <% if(error){ %>
              <div class="alert alert-danger alert-dismissable">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <strong>Â¡Error!</strong> <%= error %>
              </div>
              <% } %>
            </div>
          </div>

          <div class="row">
            <!-- Area Chart -->
            <div class="col-xl-12 col-lg-12 col-sm-12 col-xs-12">
              <!--<div class="card shadow mb-4">
                <a href="#collapseCardExample" class="d-block card-header py-3" data-toggle="collapse" role="button" aria-expanded="true" aria-controls="collapseCardExample">
                  <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-plus-circle"></i> Add Students</h6>
                </a>
                
                <div class="collapse" id="collapseCardExample">
                  <div class="card-body">
                    
                  </div>
                </div>
              </div>-->
              <div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">Request Data</h6>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-bordered display nowrap" id="dataTable" width="100%" cellspacing="0">
                    </table>
                  </div>
                </div>
              </div>
            </div>

          </div>

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>
  <!-- Modal -->
  <div class="modal fade" id="statusSolicitud" tabindex="-1" role="dialog" aria-labelledby="statusSolicitudLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="statusSolicitudLabel"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">


          <div class="row text-center justify-content-center mt-2" style="text-align:center">
            <h5 class="text-center font-weight-bold" for="">University/Company name</h5>
          </div>
          <div class="row text-center justify-content-center" style="text-align:center">
            <label class="text-center" id="nombreUniCompani"></label>
          </div>

          <hr class="m-1">

          <div class="row justify-content-center mt-2 ">
            <div class="col">
              <div class="row text-center justify-content-center" style="text-align:center">
                <h5 class="text-center font-weight-bold" for="">Name</h5>
              </div>
              <div class="row text-center justify-content-center" style="text-align:center">
                <label class="text-center" id="name"></label>
              </div>
            </div>
            <div class="col">
              <div class="row text-center justify-content-center" style="text-align:center">
                <h5 class="text-center font-weight-bold" for="">Enrollment</h5>
              </div>
              <div class="row text-center justify-content-center" style="text-align:center">
                <label class="text-center" id="matricula"></label>
              </div>

            </div>
          </div>

          <div class="row justify-content-center mt-2">
            <div class="col">
              <div class="row text-center justify-content-center" style="text-align:center">
                <h5 class="text-center font-weight-bold" for="">Email</h5>
              </div>
              <div class="row text-center justify-content-center" style="text-align:center">
                <label class="text-center" id="correo"></label>
              </div>
            </div>
            <div class="col">
              <div class="row text-center justify-content-center" style="text-align:center">
                <h5 class="text-center font-weight-bold" for="">Telephone</h5>
              </div>
              <div class="row text-center justify-content-center" style="text-align:center">
                <label class="text-center" id="telefono"></label>
              </div>

            </div>
          </div>

          <hr class="m-1">

          <div class="row text-center justify-content-center mt-2" style="text-align:center">
            <h5 class="text-center font-weight-bold" for="">Number of students</h5>
          </div>
          <div class="row text-center justify-content-center" style="text-align:center">
            <label class="text-center" id="numeroAlumnos"></label>
          </div>

          <div class="row text-center justify-content-center mt-2" style="text-align:center">
            <h5 class="text-center font-weight-bold" for="">Comments</h5>
          </div>
          <div class="row text-center justify-content-center" style="text-align:center">
            <textarea disabled class="text-center" id="comentarios"></textarea>
          </div>


          <div class="col border-top mt-3 pt-3" style="text-align:center">
            <button type="button" onclick="modificarStatus('Pending')" class=" btn btn-secondary btn-rounded" data-toggle="tooltip" data-placement="bottom">Pending</button>
            <button type="button" onclick="modificarStatus('Checking')" class="btn btn-warning btn-rounded" data-toggle="tooltip" data-placement="bottom">Checking</button>
            <button type="button" onclick="modificarStatus('Approved')" class="btn btn-success btn-rounded" data-toggle="tooltip" data-placement="bottom">Approved</button>
            <button type="button" onclick="modificarStatus('Rejected')" class="btn btn-danger btn-rounded" data-toggle="tooltip" data-placement="bottom">Rejected</button>
          </div>
          <input type="hidden" id="idSolicitud">
        </div>
      </div>
    </div>
  </div>

  <% include ../../Utilities/spinner %>

</body>

<%- contentFor('scripts')%>
<% include ./../scripts %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script>
  var log = console.log
  $(document).ready(function() {
    reloadTable()
  });
</script>
<script type="text/javascript">
  function reloadTable() {
    log("recargando tabla")
    $.ajax({
      type: "GET",
      url: "/administrador/solicitudes/datos",
      success: function(response) {
        if ($.fn.DataTable.isDataTable("#dataTable")) {
          $("#dataTable").dataTable().fnDestroy();
          $('#dataTable').empty();
        }

        var thead = ""
        var tfooter = ""

        thead += '<thead>'
        thead += '<tr>'
        thead += '<th>Name</th>'
        thead += '<th>Email</th>'
        thead += '<th>University/Company Name</th>'
        thead += '<th>Created At</th>'
        thead += '<th>Status</th>'
        thead += '<th>Action</th>'
        thead += '</tr>'
        thead += '</thead>'
        tfooter += '<tfoot>'
        tfooter += '<tr>'
        tfooter += '<th>Name</th>'
        tfooter += '<th>Email</th>'
        tfooter += '<th>University/Company Name</th>'
        tfooter += '<th>Created At</th>'
        tfooter += '<th>Status</th>'
        tfooter += '<th>Action</th>'
        tfooter += '</tr>'
        tfooter += '</tfoot>'

        $("#dataTable").append(thead)
        $("#dataTable").append(tfooter)

        $('#dataTable').dataTable({
          "scrollX": true,
          responsive: true,
          processing: true,
          lengthMenu: [100, 10, 25, 50, 75],
          order: [
            [3, "desc"]
          ],
          deferRender: true,
          data: response.data,
          columns: [{
                data: null,
                render: function(data, type, row) {
                  return data["nombre"] + " " + data["apellidoPaterno"] + " " + data["apellidoMaterno"]
                }
              },
              {
                data: null,
                render: function(data, type, row) {
                  return data["correoElectronico"]
                }
              },
              {
                data: null,
                render: function(data, type, row) {
                  return data["nombreUniversidad"]
                }
              },
              {
                data: null,
                render: function(data, type, row) {
                  return moment(data["createdAt"]).format('DD-MM-YYYY')
                }
              },
              {
                data: null,
                render: function(data, type, row) {
                  if(data["status"] === "Pending"){
                    return '<span class="badge badge-secondary">'+data["status"]+'</span>'
                  }else if(data["status"] === "Checking"){
                    return '<span class="badge badge-warning">'+data["status"]+'</span>'
                  }else if(data["status"] === "Approved"){
                    return '<span class="badge badge-success">'+data["status"]+'</span>'
                  }else if(data["status"] === "Rejected"){
                    return '<span class="badge badge-danger">'+data["status"]+'</span>'
                  }else{
                    return '<span class="badge badge-primary">'+data["status"]+'</span>'
                  }
                  
                }
              },
              {
                data: null,
                render: function(data, type, row) {
                  var nombre = data["nombre"] + " " + data["apellidoPaterno"] + " " + data["apellidoMaterno"]
                  var data_to_add = ""

                  data_to_add = "<div class='row ml-3 justify-content-center' style='width:150px'>"

                  data_to_add += "<div class='col-md-3 ml-2 mr-2'>"
                  data_to_add += '<span data-toggle="modal" data-target="#statusSolicitud"  data-status="' + data["status"] + '" data-id="' + data["objectId"] + '"data-uni="' + data["nombreUniversidad"] + '"data-nombre="' + nombre + '"data-matricula="' + data["matricula"] + '"data-telefono="' + data["telefono"] + '"data-correo="' + data["correoElectronico"] + '"data-comentarios="' + data["comentario"] + '"data-numero="' + data["numeroAlumnos"] + '"  ><button type"button" class="btn btn-primary btn-circle"  data-toggle="tooltip" data-placement="bottom" title="Details and edit status"><i class="fas fa-edit"></i></button></span>'
                  data_to_add += "</div>"

                  /*data_to_add += "<div class='col-md-3'>"
                  data_to_add += '<span data-toggle="modal" onclick="editar(\'' + data["grupoPtr"]["objectId"] + '\',\'' + data["usuarioPtr"]["objectId"] + '\')" data-target="#editModal" data-id="' + data["grupoPtr"]["objectId"] + '" data-nombre="' + data["grupoPtr"]["nombre"] + '"  data-codigo="' + data["grupoPtr"]["codigo"] + '" data-profesor="' + data["usuarioPtr"]["objectId"] + '"><button type"button" class="btn btn-primary btn-circle"  data-toggle="tooltip" data-placement="bottom" title="Edit"><i class="fas fa-edit"></i></button></span>'
                  data_to_add += "</div>"*/

                  data_to_add += "<div class='col-md-3 ml-2 mr-2'>"
                  data_to_add += '<button type"button" onclick="EliminarSolicitud(\'' + data["objectId"] + '\')" type="button" class="btn btn-danger btn-circle" data-toggle="tooltip" data-placement="bottom" title="Delete"><i class="fas fa-eraser"></i></button>'
                  data_to_add += "</div>"

                  data_to_add += "</div>"

                  return data_to_add
                }
              }
            ]
            ,
          fnInitComplete: function() {
            $('.dataTables_scrollBody').css({
              'overflow': 'hidden',
              'border': '0'
            });
            $('.dataTables_scrollFoot').css('overflow', 'auto');
            $('.dataTables_scrollFoot').on('scroll', function() {
              $('.dataTables_scrollBody').scrollLeft($(this).scrollLeft());
            });
          }
        });
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        log(textStatus)
      }
    })
  }
</script>
<script type="text/javascript">
  function EliminarSolicitud(idSolicitud) {
    Swal.fire({
      title: 'Delete!',
      text: "Do you want to delete a this request",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      cancelButtonText: 'Cancel',
      confirmButtonText: 'Delete'
    }).then((result) => {
      if (result.value) {
        $('#spinner').modal('show')
        $.ajax({
          type: "POST",
          url: "/administrador/solicitudes/solicitud_eliminar",
          data: {
            "idSolicitud": idSolicitud
          },
          success: function(response) {
            reloadTable()
            $('#spinner').modal('hide')
            Swal.fire(
              'Delete!',
              'The request has been successfully deleted',
              'success'
            )
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
            $('#spinner').modal('hide')
            Swal.fire(
              'Error!',
              'An error occurred while performing the action, please try again',
              'error'
            )
          }
        })
      }
    })
  }
</script>
<script type="text/javascript">
  $('#statusSolicitud').on('show.bs.modal', function(e) {

    var status = $(e.relatedTarget).data('status');
    var id = $(e.relatedTarget).data('id');
    var uni = $(e.relatedTarget).data('uni');
    var nombre = $(e.relatedTarget).data('nombre');
    var matricula = $(e.relatedTarget).data('matricula');
    var correo = $(e.relatedTarget).data('correo');
    var telefono = $(e.relatedTarget).data('telefono');
    var numeroAlumnos = $(e.relatedTarget).data('numero');
    var comentarios = $(e.relatedTarget).data('comentarios');
    $("#idSolicitud").val(id)
    if(status=="Pending"){
      $("#statusSolicitudLabel").css('color', '#6c757d');
    }
    if(status=="Checking"){
      $("#statusSolicitudLabel").css('color', '#ffc107');
    }
    if(status=="Approved"){
      $("#statusSolicitudLabel").css('color', '#28a745');
    }
    if(status=="Rejected"){
      $("#statusSolicitudLabel").css('color', '#dc3545');
    }
    $("#statusSolicitudLabel").text(status)
    $("#nombreUniCompani").text(uni)
    $("#name").text(nombre)
    $("#matricula").text(matricula)
    $("#correo").text(correo)
    $("#telefono").text(telefono)
    $("#numeroAlumnos").text(numeroAlumnos)
    $("#comentarios").text(comentarios)
  });

  function modificarStatus(status) {

    Swal.fire({
      title: 'Change status!',
      text: `Sure you want to put in ${status}`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      cancelButtonText: 'Cancel',
      confirmButtonText: 'confirm'
    }).then((result) => {
      if (result.value) {
        $("#spinner").modal('show')
        $.ajax({
          type: "POST",
          url: "/administrador/solicitudes/solicitud_cambiar_status",
          data: {
            "idSolicitud": $("#idSolicitud").val(),
            "status": status
          },
          success: function(response) {
            $('#spinner').modal('hide')
            $("#statusSolicitud").modal('hide')
            reloadTable()
            Swal.fire(
              'Changed!',
              'The request has been successfully changed status',
              'success'
            )
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
            $("#spinner").modal('hide')
            Swal.fire(
              'Error!',
              'An error occurred while performing the action, please try again',
              'error'
            )
          }
        })
      } else {
        $("#statusSolicitud").modal('hide')
      }
    })

  }
</script>