<%- contentFor('head')%>
<% include ./../css %>
<style type="text/css">
body,
  #game-container {
    margin: 0;
    padding: 0;
  }

  #game-container {
    /*min-width: 100vw;
    min-height: 100vh;*/
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #game-container>canvas {
    border-radius: 5px;
  }
</style>

<%- contentFor('body')%>
<body id="page-top" class="sidebar-toggled">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <% include ./../sidebar %>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <% include ./../top-bar %>        

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <div class="row">
            <div class="col-md-12">
              <% if(error){ %>
              <div class="alert alert-danger alert-dismissable">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <strong>Â¡Error!</strong> <%= error %>
              </div>
              <% } %>
            </div>
          </div>

          <div class="row">
            <!-- Area Chart -->
            <div class="col-xl-2 col-lg-2 d-xl-block d-lg-none d-md-none d-sm-none d-none ">
               <div class="row pl-3 pt-4 pr-5">
                <span style="font-size: small; text-align: justify;">Click Start <i class="fas fa-arrow-left"></i> : To enable controls</span>
              </div>
              <div class="row pl-3 pt-4 pr-5">
                <span style="font-size: small; text-align: justify;">Key <i class="fas fa-arrow-left"></i> : Move to the left side</span>
              </div>
              <div class="row pl-3 pt-4 pr-5">
                <span style="font-size: small; text-align: justify;">Key <i class="fas fa-arrow-right"></i>: Move to the right side</span>
              </div>
              <div class="row pl-3 pt-4 pr-5">
                <span style="font-size: small; text-align: justify;"><strong>Space Bar</strong> Key: Activate portals</span>
              </div>
              <div class="row pl-3 pt-4 pr-5">
                <span style="font-size: small; text-align: justify;"><strong>Space Bar</strong> key: Activate computer components</span>
              </div>
              <div class="row pl-3 pt-4 pr-5">
                <span style="font-size: small; text-align: justify;"><strong>*</strong> If "Space Bar Key" doesn't work, you need to click "Start"</span>
              </div>
              <div class="row pl-3 pt-4 pr-5">
                <span style="font-size: small; text-align: justify;"><strong>*</strong> Move your character select the screen inside the game to make use of the controls</span>
              </div>
            </div>
            <div class="col-xl-8 col-lg-12 col-sm-12 col-xs-12">
              <div id="game-container"></div>
            </div>
            <div class="col-xl-2 col-lg-2 d-xl-block d-lg-none d-md-none d-sm-none d-none p-4">
             <button id="istructionFactory" class="text-primary" style="font-size: small; border:0px; background:#f8f9fc; outline:none;"> Let's make your factory work!</button>
            </div>
          </div>

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <% include ./../modals %>
</body>

<%- contentFor('scripts')%>
<% include ./../scripts %>
<!----DUMMY----->
<script type="text/javascript">
  var simulation = null
  var simulationStarted = null
  var simulacionDateCurrentFinancialLog = null
  var currenDateForRawmaterial = null
  var currentDateForStatusServer = null
  var dateForStatusServer = null
  var speedSimulation = null
  $(document).ready(function() { 
    const socket = io({ query: { token: '<%= simulation.id %>' } })

    socket.on('push_message', function (result) {
      log("Received push")
      log(result)
      if(result.status == "<%= CONSTANTS.SUCCESS %>"){
        switch(result.type){
          case "<%= CONSTANTS.ASK_FOR_SIMULATION %>":
            if(result){
              simulation = result.data
            }
          break;
          case "<%= CONSTANTS.HOUR_CHANGE %>":
            if(result){
              updateHourChange(result)
            }
          break;
        }
      }else{
        log(result.error)
      }
    })

    function askForSimulation(){
      if(simulation == null){
        var solicitude = {type:"<%= CONSTANTS.ASK_FOR_SIMULATION %>", token: '<%= simulation.id %>'}
        solicitude = JSON.stringify(solicitude)
        socket.emit('push_message_delivery', solicitude)
      }else{
        setTimeout(askForSimulation, 5000)  
      }
    }
    askForSimulation()

    var simulationTime = moment(Number("<%= simulation.get('currentDate') %>"))
    simulacionDateCurrentFinancialLog = simulationTime
    currenDateForRawmaterial = simulationTime
    dateForStatusServer = simulationTime
    currentDateForStatusServer = simulationTime
    speedSimulation = "<%= simulation.get('speedSimulation') %>"
    $("#expiredTime").html(simulationTime.format("DD/MM/YYYY HH:mm"))

    reloadCurrencyMoney()
    startPopover()

  });
</script>
<script type="text/javascript">
  function startPopover (){
    $("#istructionFactory").attr("data-toggle","popover")
    $("#istructionFactory").attr("data-placement","left")
    $("#istructionFactory").attr("title","Are you ready!")
    $("#istructionFactory").attr("data-content",stepsStartFactory())
    $('[data-toggle="popover"]').popover({
          trigger: 'focus',
          html : true,
    }); 

    $('#istructionFactory').on('show.bs.popover', function () {
      $($(this).data("bs.popover").getTipElement()).css("max-width", "60%").css("margin-top","30px");
    })
  }
  
  function cssPopover(){
      $("#istructionFactory").popover('toggle')
  }

  function stepsStartFactory (){
    var components ='<div class="modal-body">'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>1</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Find the BOM, see which products you can sell and check out their raw materials</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>2</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Go back to the BOM and perform the material explosion</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>3</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">It\'s time to get your first customer, go to Orders section, select one and negotiate it in order to obtain the best profit for your factory</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>4</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">If you don\'t have inventory search for the suppliers section in Purchasing option, select the raw material and quantity that you need for your orders and purchase it. Be careful with delivery days!</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>5</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">You can follow the progress of your purchase orders in Status Order section</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>6</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Wait until any purchase order arrives, meanwhile your can enable your production line</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>7</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Find the Production Line option and check out what do you need for each phase, to enable it. Ready?</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>8</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">If you don\'t have fixed assets inventory, go to the Finance option and buy and assign the fixed assets needed for each phase. Done?</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>9</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Now, the machines are not so intelligent so we need employees. Let\'s go to the Employees option, select the department of Production Line and for each phase hire the workers needed</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>10</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Assign a shift to hired employees in the same "Employees" option</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>11</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Go to the Production Line option and fill in the data of the production line that you are going to activate</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>12</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Receive your raw material in the "Raw Material" option</span>'
                      +'</div>'
                      +'<div class="row pl-4 pt-3 pr-1">'
                        +'<span style="font-size: small; text-align: justify;"><strong>13</strong> </span> <span style="font-size: small; text-align: justify;" class="col-11">Excellent! Your factory is ready to start manufacturing. Let\'s make some money!</span>'
                      +'</div>'
                    +'</div>'
    return components
  }
</script>
<% include ./../functionality %>